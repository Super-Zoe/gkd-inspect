import{d as ae,m as N,h as k,o as z,i as R,e as j,j as I,u as q,k as H,p as X,b as G,a as x,g as V}from"./storage-4001c6f9.js";import{N as se,u as _,d as S,b as J,c as C}from"./node-5f824ca2.js";import{b as u,an as ie,d as re,am as le,c as ce,o as b,ae as A,g as l,f as pe,u as r,j as m,l as E,k as L,h as f}from"./index-94e86206.js";import{i as K,a as W,J as O}from"./file_type-1814f3cc.js";const $=({title:e="批量分享链接",content:t=""})=>{ae.success({title:e,style:{width:"800px"},content(){return u(se,{type:"textarea",autosize:{minRows:8,maxRows:16},inputProps:{style:"white-space: nowrap;"},value:t},null)},positiveText:"复制",onPositiveClick(){return navigator.clipboard.writeText(t).then(()=>{N.success("复制成功")}).catch(()=>{N.success("复制失败")}),!1}})};var Q={exports:{}};(function(e,t){(function(a,s){s()})(k,function(){function a(o,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function s(o,n,h){var i=new XMLHttpRequest;i.open("GET",o),i.responseType="blob",i.onload=function(){v(i.response,n,h)},i.onerror=function(){console.error("could not download file")},i.send()}function c(o){var n=new XMLHttpRequest;n.open("HEAD",o,!1);try{n.send()}catch{}return 200<=n.status&&299>=n.status}function w(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(n)}}var p=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof k=="object"&&k.global===k?k:void 0,g=p.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),v=p.saveAs||(typeof window!="object"||window!==p?function(){}:"download"in HTMLAnchorElement.prototype&&!g?function(o,n,h){var i=p.URL||p.webkitURL,d=document.createElement("a");n=n||o.name||"download",d.download=n,d.rel="noopener",typeof o=="string"?(d.href=o,d.origin===location.origin?w(d):c(d.href)?s(o,n,h):w(d,d.target="_blank")):(d.href=i.createObjectURL(o),setTimeout(function(){i.revokeObjectURL(d.href)},4e4),setTimeout(function(){w(d)},0))}:"msSaveOrOpenBlob"in navigator?function(o,n,h){if(n=n||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(a(o,h),n);else if(c(o))s(o,n,h);else{var i=document.createElement("a");i.href=o,i.target="_blank",setTimeout(function(){w(i)})}}:function(o,n,h,i){if(i=i||open("","_blank"),i&&(i.document.title=i.document.body.innerText="downloading..."),typeof o=="string")return s(o,n,h);var d=o.type==="application/octet-stream",ne=/constructor/i.test(p.HTMLElement)||p.safari,D=/CriOS\/[\d]+/.test(navigator.userAgent);if((D||d&&ne||g)&&typeof FileReader<"u"){var B=new FileReader;B.onloadend=function(){var y=B.result;y=D?y:y.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=y:location=y,i=null},B.readAsDataURL(o)}else{var F=p.URL||p.webkitURL,P=F.createObjectURL(o);i?i.location=P:location.href=P,i=null,setTimeout(function(){F.revokeObjectURL(P)},4e4)}});p.saveAs=v.saveAs=v,e.exports=v})})(Q);var T=Q.exports;const Y="https://github.com/gkd-kit/inspect/issues/new",ue="661952005",U={origin:"https://github.com",referer:Y},de=async()=>{var c;const e='[data-upload-policy-url="/upload/policies/assets"] input.js-data-upload-policy-url-csrf',t=await R(Y);return(c=new DOMParser().parseFromString(await t.text(),"text/html").querySelector(e))==null?void 0:c.getAttribute("value")},ee=async e=>{const[t,a]=(()=>{if(K(e))return["file.png","image/png"];if(W(e))return["file.zip","application/x-zip-compressed"];throw new Error("invalid buffer, it must be png or zip")})(),s=new File([e],t,{type:a}),c=await fetch("https://github-upload-assets.lisonge.workers.dev/",{method:"POST",body:z({file:s})});return c.headers.get("X_RPC_OK")==="true"?c.json():fe(e)},fe=async e=>{const[t,a]=(()=>{if(K(e))return["file.png","image/png"];if(W(e))return["file.zip","application/x-zip-compressed"];throw new Error("invalid buffer, it must be png or zip")})(),s=await de();if(!s)throw ie.githubErrorDlgVisible=!0,new Error("failed get csrfToken");const c=await R("https://github.com/upload/policies/assets",{method:"POST",body:z({authenticity_token:s,content_type:a,name:t,size:e.byteLength,repository_id:ue}),headers:U}).then(g=>{if(!g.ok)throw new Error("failed upload policies assets");return g.json()});if(!(await R(c.upload_url,{method:"POST",body:z(c.form,{file:new File([e],t,{type:a})}),headers:U})).ok)throw new Error("upload s3 failed");if((await R(new URL(c.asset_upload_url,"https://github.com/").href,{method:"PUT",body:z({authenticity_token:c.asset_upload_authenticity_token}),headers:{...U,Accept:"application/json"}})).status!=200)throw new Error("failed check authenticity upload");return c.asset},M=async e=>{const t=new O;return t.file("snapshot.json",JSON.stringify(e)).file("screenshot.png",await G.getItem(e.id)),await t.generateAsync({type:"blob",compression:"STORE"})},he=async e=>{const t=`snapshot-${e.id}.zip`;T.saveAs(await M(e),t)},Z=async e=>{const t=await G.getItem(e.id);return new Blob([t,JSON.stringify(e)])},we=async e=>{const t=`snapshot-${e.id}.png`;T.saveAs(await Z(e),t)},Ae=async e=>{const t=new O;for(const s of e)await j(),t.file(s.id+".png",Z(s));const a=await t.generateAsync({type:"blob",compression:"STORE"});T.saveAs(a,`batch-png-${e.length}.zip`)},Ee=async e=>{const t=new O;for(const s of e)await j(),t.file(s.id+".zip",await M(s));const a=await t.generateAsync({type:"blob",compression:"STORE"});T.saveAs(a,`batch-zip-${e.length}.zip`)},te=async e=>I[e.id]??ee(await Z(e).then(t=>t.arrayBuffer())).then(t=>(q[t.href]=e.id,I[e.id]=t.href,t.href)),oe=async e=>H[e.id]??ee(await M(e).then(t=>t.arrayBuffer())).then(t=>(H[e.id]=t.href,q[t.href]=e.id,t.href)),Le=async e=>{const t=X(3);return(await Promise.allSettled(e.map(a=>t(()=>te(a))))).reduce((a,s)=>(s.status=="fulfilled"&&a.push(s.value),a),[])},ze=async e=>{const t=X(3);return(await Promise.allSettled(e.map(a=>t(()=>oe(a))))).reduce((a,s)=>(s.status=="fulfilled"&&a.push(s.value),a),[])},ge=["href"],me=f("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200"},[f("path",{d:"M549.973333 128 633.6 145.066667 474.026667 896 390.4 878.933333 549.973333 128M835.84 512 682.666667 358.826667 682.666667 238.08 956.586667 512 682.666667 785.493333 682.666667 664.746667 835.84 512M67.413333 512 341.333333 238.08 341.333333 358.826667 188.16 512 341.333333 664.746667 341.333333 785.493333 67.413333 512Z"})],-1),ve=f("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[f("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[f("path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"}),f("path",{d:"M7 11l5 5l5-5"}),f("path",{d:"M12 4v12"})])],-1),ye=f("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[f("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81c1.66 0 3-1.34 3-3s-1.34-3-3-3s-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65c0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z",fill:"currentColor"})],-1),ke=f("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[f("g",{fill:"none"},[f("path",{d:"M12 1.75a3.25 3.25 0 0 1 3.245 3.066L15.25 5h5.25a.75.75 0 0 1 .102 1.493L20.5 6.5h-.796l-1.28 13.02a2.75 2.75 0 0 1-2.561 2.474l-.176.006H8.313a2.75 2.75 0 0 1-2.714-2.307l-.023-.174L4.295 6.5H3.5a.75.75 0 0 1-.743-.648L2.75 5.75a.75.75 0 0 1 .648-.743L3.5 5h5.25A3.25 3.25 0 0 1 12 1.75zm6.197 4.75H5.802l1.267 12.872a1.25 1.25 0 0 0 1.117 1.122l.127.006h7.374c.6 0 1.109-.425 1.225-1.002l.02-.126L18.196 6.5zM13.75 9.25a.75.75 0 0 1 .743.648L14.5 10v7a.75.75 0 0 1-1.493.102L13 17v-7a.75.75 0 0 1 .75-.75zm-3.5 0a.75.75 0 0 1 .743.648L11 10v7a.75.75 0 0 1-1.493.102L9.5 17v-7a.75.75 0 0 1 .75-.75zm1.75-6a1.75 1.75 0 0 0-1.744 1.606L10.25 5h3.5A1.75 1.75 0 0 0 12 3.25z",fill:"currentColor"})])],-1),Re=re({__name:"ActionCard",props:{snapshot:{},onDelete:{type:Function,default:()=>()=>{}},showPreview:{type:Boolean,default:!0},showExport:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},showShare:{type:Boolean,default:!0}},setup(e){const t=e,a=le(),s=_(async()=>we(await x.getItem(t.snapshot.id))),c=_(async()=>he(await x.getItem(t.snapshot.id))),w=ce(()=>a.resolve({name:"snapshot",params:{snapshotId:t.snapshot.id}}).href),p=_(async()=>{const o=await te(await x.getItem(t.snapshot.id));$({title:"分享链接",content:V(o)})}),g=_(async()=>{const o=await oe(await x.getItem(t.snapshot.id));$({title:"分享链接",content:V(o)})}),v=async()=>{await x.removeItem(t.snapshot.id),await j(500),t.onDelete()};return(o,n)=>(b(),A(r(C),null,{default:l(()=>[o.showPreview?(b(),pe("a",{key:0,target:"_blank",href:w.value},[u(r(m),{size:"small"},{icon:l(()=>[u(r(S),null,{default:l(()=>[me]),_:1})]),_:1})],8,ge)):E("",!0),o.showExport?(b(),A(r(J),{key:1},{trigger:l(()=>[u(r(m),{size:"small"},{icon:l(()=>[u(r(S),null,{default:l(()=>[ve]),_:1})]),_:1})]),default:l(()=>[u(r(C),{vertical:""},{default:l(()=>[u(r(m),{onClick:r(s).invoke,loading:r(s).loading},{default:l(()=>[L(" 下载-png ")]),_:1},8,["onClick","loading"]),u(r(m),{onClick:r(c).invoke,loading:r(c).loading},{default:l(()=>[L(" 下载-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):E("",!0),o.showShare?(b(),A(r(J),{key:2},{trigger:l(()=>[u(r(m),{size:"small"},{icon:l(()=>[u(r(S),null,{default:l(()=>[ye]),_:1})]),_:1})]),default:l(()=>[u(r(C),{vertical:""},{default:l(()=>[u(r(m),{onClick:r(p).invoke,loading:r(p).loading},{default:l(()=>[L(" 生成链接-png ")]),_:1},8,["onClick","loading"]),u(r(m),{onClick:r(g).invoke,loading:r(g).loading},{default:l(()=>[L(" 生成链接-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):E("",!0),o.showDelete?(b(),A(r(m),{key:3,size:"small",onClick:v},{icon:l(()=>[u(r(S),null,{default:l(()=>[ke]),_:1})]),_:1})):E("",!0)]),_:1}))}});export{Re as _,Ee as a,Ae as b,Le as c,ze as d,$ as s};
//# sourceMappingURL=ActionCard.vue_vue_type_script_setup_true_lang-a33114b7.js.map
