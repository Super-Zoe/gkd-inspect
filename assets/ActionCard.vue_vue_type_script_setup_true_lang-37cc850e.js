import{d as te,m as N,h as k,i as z,o as U,e as j,j as I,k as H,p as q,b as G,a as b,g as V}from"./storage-08f70e23.js";import{N as oe,u as _,d as S,b as J,c as C}from"./node-b117f2ba.js";import{b as p,an as ne,d as ae,am as se,c as ie,o as x,ae as A,g as l,f as re,u as s,j as m,l as L,k as E,h}from"./index-3b977556.js";import{i as le,a as ce,J as M}from"./file_type-9a7ead53.js";const $=({title:t="批量分享链接",content:e=""})=>{te.success({title:t,style:{width:"800px"},content(){return p(oe,{type:"textarea",autosize:{minRows:8,maxRows:16},inputProps:{style:"white-space: nowrap;"},value:e},null)},positiveText:"复制",onPositiveClick(){return navigator.clipboard.writeText(e).then(()=>{N.success("复制成功")}).catch(()=>{N.success("复制失败")}),!1}})};var X={exports:{}};(function(t,e){(function(i,r){r()})(k,function(){function i(o,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function r(o,n,w){var a=new XMLHttpRequest;a.open("GET",o),a.responseType="blob",a.onload=function(){g(a.response,n,w)},a.onerror=function(){console.error("could not download file")},a.send()}function f(o){var n=new XMLHttpRequest;n.open("HEAD",o,!1);try{n.send()}catch{}return 200<=n.status&&299>=n.status}function d(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(n)}}var c=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof k=="object"&&k.global===k?k:void 0,v=c.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=c.saveAs||(typeof window!="object"||window!==c?function(){}:"download"in HTMLAnchorElement.prototype&&!v?function(o,n,w){var a=c.URL||c.webkitURL,u=document.createElement("a");n=n||o.name||"download",u.download=n,u.rel="noopener",typeof o=="string"?(u.href=o,u.origin===location.origin?d(u):f(u.href)?r(o,n,w):d(u,u.target="_blank")):(u.href=a.createObjectURL(o),setTimeout(function(){a.revokeObjectURL(u.href)},4e4),setTimeout(function(){d(u)},0))}:"msSaveOrOpenBlob"in navigator?function(o,n,w){if(n=n||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(i(o,w),n);else if(f(o))r(o,n,w);else{var a=document.createElement("a");a.href=o,a.target="_blank",setTimeout(function(){d(a)})}}:function(o,n,w,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof o=="string")return r(o,n,w);var u=o.type==="application/octet-stream",ee=/constructor/i.test(c.HTMLElement)||c.safari,D=/CriOS\/[\d]+/.test(navigator.userAgent);if((D||u&&ee||v)&&typeof FileReader<"u"){var B=new FileReader;B.onloadend=function(){var y=B.result;y=D?y:y.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=y:location=y,a=null},B.readAsDataURL(o)}else{var F=c.URL||c.webkitURL,R=F.createObjectURL(o);a?a.location=R:location.href=R,a=null,setTimeout(function(){F.revokeObjectURL(R)},4e4)}});c.saveAs=g.saveAs=g,t.exports=g})})(X);var T=X.exports;const K="https://github.com/gkd-kit/inspect/issues/new",pe="661952005",P={origin:"https://github.com",referer:K},ue=async()=>{var f;const t='[data-upload-policy-url="/upload/policies/assets"] input.js-data-upload-policy-url-csrf',e=await z(K);return(f=new DOMParser().parseFromString(await e.text(),"text/html").querySelector(t))==null?void 0:f.getAttribute("value")},W=async(t,e)=>{const[i,r]=(()=>{if(le(t))return[e||"file.png","image/png"];if(ce(t))return[e||"file.zip","application/x-zip-compressed"];throw new Error("invalid buffer, it must be png or zip")})(),f=await ue();if(!f)throw ne.githubErrorDlgVisible=!0,new Error("failed get csrfToken");const d=await z("https://github.com/upload/policies/assets",{method:"POST",body:U({authenticity_token:f,content_type:r,name:i,size:t.byteLength,repository_id:pe}),headers:P}).then(g=>{if(!g.ok)throw new Error("failed upload policies assets");return g.json()});if(!(await z(d.upload_url,{method:"POST",body:U(d.form,{file:new File([t],i,{type:r})}),headers:P})).ok)throw new Error("upload s3 failed");if((await z(new URL(d.asset_upload_url,"https://github.com/").href,{method:"PUT",body:U({authenticity_token:d.asset_upload_authenticity_token}),headers:{...P,Accept:"application/json"}})).status!=200)throw new Error("failed check authenticity upload");return d.asset},O=async t=>{const e=new M;return e.file("snapshot.json",JSON.stringify(t)).file("screenshot.png",await G.getItem(t.id)),await e.generateAsync({type:"blob",compression:"STORE"})},de=async t=>{const e=`snapshot-${t.id}.zip`;T.saveAs(await O(t),e)},Z=async t=>{const e=await G.getItem(t.id);return new Blob([e,JSON.stringify(t)])},he=async t=>{const e=`snapshot-${t.id}.png`;T.saveAs(await Z(t),e)},_e=async t=>{const e=new M;for(const r of t)await j(),e.file(r.id+".png",Z(r));const i=await e.generateAsync({type:"blob",compression:"STORE"});T.saveAs(i,`batch-png-${t.length}.zip`)},Se=async t=>{const e=new M;for(const r of t)await j(),e.file(r.id+".zip",await O(r));const i=await e.generateAsync({type:"blob",compression:"STORE"});T.saveAs(i,`batch-zip-${t.length}.zip`)},Q=async t=>I[t.id]??W(await Z(t).then(e=>e.arrayBuffer())).then(e=>(I[t.id]=e.href,e.href)),Y=async t=>H[t.id]??W(await O(t).then(e=>e.arrayBuffer())).then(e=>(H[t.id]=e.href,e.href)),Ae=async t=>{const e=q(3);return(await Promise.allSettled(t.map(i=>e(()=>Q(i))))).reduce((i,r)=>(r.status=="fulfilled"&&i.push(r.value),i),[])},Le=async t=>{const e=q(3);return(await Promise.allSettled(t.map(i=>e(()=>Y(i))))).reduce((i,r)=>(r.status=="fulfilled"&&i.push(r.value),i),[])},fe=["href"],we=h("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200"},[h("path",{d:"M549.973333 128 633.6 145.066667 474.026667 896 390.4 878.933333 549.973333 128M835.84 512 682.666667 358.826667 682.666667 238.08 956.586667 512 682.666667 785.493333 682.666667 664.746667 835.84 512M67.413333 512 341.333333 238.08 341.333333 358.826667 188.16 512 341.333333 664.746667 341.333333 785.493333 67.413333 512Z"})],-1),ge=h("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[h("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[h("path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"}),h("path",{d:"M7 11l5 5l5-5"}),h("path",{d:"M12 4v12"})])],-1),me=h("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[h("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81c1.66 0 3-1.34 3-3s-1.34-3-3-3s-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65c0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z",fill:"currentColor"})],-1),ve=h("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[h("g",{fill:"none"},[h("path",{d:"M12 1.75a3.25 3.25 0 0 1 3.245 3.066L15.25 5h5.25a.75.75 0 0 1 .102 1.493L20.5 6.5h-.796l-1.28 13.02a2.75 2.75 0 0 1-2.561 2.474l-.176.006H8.313a2.75 2.75 0 0 1-2.714-2.307l-.023-.174L4.295 6.5H3.5a.75.75 0 0 1-.743-.648L2.75 5.75a.75.75 0 0 1 .648-.743L3.5 5h5.25A3.25 3.25 0 0 1 12 1.75zm6.197 4.75H5.802l1.267 12.872a1.25 1.25 0 0 0 1.117 1.122l.127.006h7.374c.6 0 1.109-.425 1.225-1.002l.02-.126L18.196 6.5zM13.75 9.25a.75.75 0 0 1 .743.648L14.5 10v7a.75.75 0 0 1-1.493.102L13 17v-7a.75.75 0 0 1 .75-.75zm-3.5 0a.75.75 0 0 1 .743.648L11 10v7a.75.75 0 0 1-1.493.102L9.5 17v-7a.75.75 0 0 1 .75-.75zm1.75-6a1.75 1.75 0 0 0-1.744 1.606L10.25 5h3.5A1.75 1.75 0 0 0 12 3.25z",fill:"currentColor"})])],-1),Ee=ae({__name:"ActionCard",props:{snapshot:{},onDelete:{type:Function,default:()=>()=>{}},showPreview:{type:Boolean,default:!0},showExport:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},showShare:{type:Boolean,default:!0}},setup(t){const e=t,i=se(),r=_(async()=>he(await b.getItem(e.snapshot.id))),f=_(async()=>de(await b.getItem(e.snapshot.id))),d=ie(()=>i.resolve({name:"snapshot",params:{snapshotId:e.snapshot.id}}).href),c=_(async()=>{const o=await Q(await b.getItem(e.snapshot.id));$({title:"分享链接",content:V(o)})}),v=_(async()=>{const o=await Y(await b.getItem(e.snapshot.id));$({title:"分享链接",content:V(o)})}),g=async()=>{await b.removeItem(e.snapshot.id),await j(500),e.onDelete()};return(o,n)=>(x(),A(s(C),null,{default:l(()=>[o.showPreview?(x(),re("a",{key:0,target:"_blank",href:d.value},[p(s(m),{size:"small"},{icon:l(()=>[p(s(S),null,{default:l(()=>[we]),_:1})]),_:1})],8,fe)):L("",!0),o.showExport?(x(),A(s(J),{key:1},{trigger:l(()=>[p(s(m),{size:"small"},{icon:l(()=>[p(s(S),null,{default:l(()=>[ge]),_:1})]),_:1})]),default:l(()=>[p(s(C),{vertical:""},{default:l(()=>[p(s(m),{onClick:s(r).invoke,loading:s(r).loading},{default:l(()=>[E(" 下载-png ")]),_:1},8,["onClick","loading"]),p(s(m),{onClick:s(f).invoke,loading:s(f).loading},{default:l(()=>[E(" 下载-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):L("",!0),o.showShare?(x(),A(s(J),{key:2},{trigger:l(()=>[p(s(m),{size:"small"},{icon:l(()=>[p(s(S),null,{default:l(()=>[me]),_:1})]),_:1})]),default:l(()=>[p(s(C),{vertical:""},{default:l(()=>[p(s(m),{onClick:s(c).invoke,loading:s(c).loading},{default:l(()=>[E(" 生成链接-png ")]),_:1},8,["onClick","loading"]),p(s(m),{onClick:s(v).invoke,loading:s(v).loading},{default:l(()=>[E(" 生成链接-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):L("",!0),o.showDelete?(x(),A(s(m),{key:3,size:"small",onClick:g},{icon:l(()=>[p(s(S),null,{default:l(()=>[ve]),_:1})]),_:1})):L("",!0)]),_:1}))}});export{Ee as _,Se as a,_e as b,Ae as c,Le as d,$ as s};
//# sourceMappingURL=ActionCard.vue_vue_type_script_setup_true_lang-37cc850e.js.map
