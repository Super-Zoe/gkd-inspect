import{d as oe,m as F,h as k,i as z,o as P,e as j,j as I,u as q,k as H,p as G,b as X,a as b,g as V}from"./storage-27401f68.js";import{N as ne,u as _,d as S,b as J,c as U}from"./node-08248ba8.js";import{b as u,an as ae,d as se,am as ie,c as re,o as x,ae as A,g as l,f as le,u as s,j as g,l as E,k as L,h as f}from"./index-dd076c97.js";import{i as ce,a as pe,J as M}from"./file_type-2a8d15eb.js";const $=({title:t="批量分享链接",content:e=""})=>{oe.success({title:t,style:{width:"800px"},content(){return u(ne,{type:"textarea",autosize:{minRows:8,maxRows:16},inputProps:{style:"white-space: nowrap;"},value:e},null)},positiveText:"复制",onPositiveClick(){return navigator.clipboard.writeText(e).then(()=>{F.success("复制成功")}).catch(()=>{F.success("复制失败")}),!1}})};var K={exports:{}};(function(t,e){(function(i,r){r()})(k,function(){function i(o,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function r(o,n,h){var a=new XMLHttpRequest;a.open("GET",o),a.responseType="blob",a.onload=function(){v(a.response,n,h)},a.onerror=function(){console.error("could not download file")},a.send()}function c(o){var n=new XMLHttpRequest;n.open("HEAD",o,!1);try{n.send()}catch{}return 200<=n.status&&299>=n.status}function m(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(n)}}var p=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof k=="object"&&k.global===k?k:void 0,w=p.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),v=p.saveAs||(typeof window!="object"||window!==p?function(){}:"download"in HTMLAnchorElement.prototype&&!w?function(o,n,h){var a=p.URL||p.webkitURL,d=document.createElement("a");n=n||o.name||"download",d.download=n,d.rel="noopener",typeof o=="string"?(d.href=o,d.origin===location.origin?m(d):c(d.href)?r(o,n,h):m(d,d.target="_blank")):(d.href=a.createObjectURL(o),setTimeout(function(){a.revokeObjectURL(d.href)},4e4),setTimeout(function(){m(d)},0))}:"msSaveOrOpenBlob"in navigator?function(o,n,h){if(n=n||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(i(o,h),n);else if(c(o))r(o,n,h);else{var a=document.createElement("a");a.href=o,a.target="_blank",setTimeout(function(){m(a)})}}:function(o,n,h,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof o=="string")return r(o,n,h);var d=o.type==="application/octet-stream",te=/constructor/i.test(p.HTMLElement)||p.safari,D=/CriOS\/[\d]+/.test(navigator.userAgent);if((D||d&&te||w)&&typeof FileReader<"u"){var T=new FileReader;T.onloadend=function(){var y=T.result;y=D?y:y.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=y:location=y,a=null},T.readAsDataURL(o)}else{var N=p.URL||p.webkitURL,R=N.createObjectURL(o);a?a.location=R:location.href=R,a=null,setTimeout(function(){N.revokeObjectURL(R)},4e4)}});p.saveAs=v.saveAs=v,t.exports=v})})(K);var B=K.exports;const W="https://github.com/gkd-kit/inspect/issues/new",ue="661952005",C={origin:"https://github.com",referer:W},de=async()=>{var c;const t='[data-upload-policy-url="/upload/policies/assets"] input.js-data-upload-policy-url-csrf',e=await z(W);return(c=new DOMParser().parseFromString(await e.text(),"text/html").querySelector(t))==null?void 0:c.getAttribute("value")},Q=async t=>fe(t),fe=async t=>{const[e,i]=(()=>{if(ce(t))return["file.png","image/png"];if(pe(t))return["file.zip","application/x-zip-compressed"];throw new Error("invalid buffer, it must be png or zip")})(),r=await de();if(!r)throw ae.githubErrorDlgVisible=!0,new Error("failed get csrfToken");const c=await z("https://github.com/upload/policies/assets",{method:"POST",body:P({authenticity_token:r,content_type:i,name:e,size:t.byteLength,repository_id:ue}),headers:C}).then(w=>{if(!w.ok)throw new Error("failed upload policies assets");return w.json()});if(!(await z(c.upload_url,{method:"POST",body:P(c.form,{file:new File([t],e,{type:i})}),headers:C})).ok)throw new Error("upload s3 failed");if((await z(new URL(c.asset_upload_url,"https://github.com/").href,{method:"PUT",body:P({authenticity_token:c.asset_upload_authenticity_token}),headers:{...C,Accept:"application/json"}})).status!=200)throw new Error("failed check authenticity upload");return c.asset},O=async t=>{const e=new M;return e.file("snapshot.json",JSON.stringify(t)).file("screenshot.png",await X.getItem(t.id)),await e.generateAsync({type:"blob",compression:"STORE"})},he=async t=>{const e=`snapshot-${t.id}.zip`;B.saveAs(await O(t),e)},Z=async t=>{const e=await X.getItem(t.id);return new Blob([e,JSON.stringify(t)])},we=async t=>{const e=`snapshot-${t.id}.png`;B.saveAs(await Z(t),e)},Ae=async t=>{const e=new M;for(const r of t)await j(),e.file(r.id+".png",Z(r));const i=await e.generateAsync({type:"blob",compression:"STORE"});B.saveAs(i,`batch-png-${t.length}.zip`)},Ee=async t=>{const e=new M;for(const r of t)await j(),e.file(r.id+".zip",await O(r));const i=await e.generateAsync({type:"blob",compression:"STORE"});B.saveAs(i,`batch-zip-${t.length}.zip`)},Y=async t=>I[t.id]??Q(await Z(t).then(e=>e.arrayBuffer())).then(e=>(q[e.href]=t.id,I[t.id]=e.href,e.href)),ee=async t=>H[t.id]??Q(await O(t).then(e=>e.arrayBuffer())).then(e=>(H[t.id]=e.href,q[e.href]=t.id,e.href)),Le=async t=>{const e=G(3);return(await Promise.allSettled(t.map(i=>e(()=>Y(i))))).reduce((i,r)=>(r.status=="fulfilled"&&i.push(r.value),i),[])},ze=async t=>{const e=G(3);return(await Promise.allSettled(t.map(i=>e(()=>ee(i))))).reduce((i,r)=>(r.status=="fulfilled"&&i.push(r.value),i),[])},ge=["href"],me=f("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200"},[f("path",{d:"M549.973333 128 633.6 145.066667 474.026667 896 390.4 878.933333 549.973333 128M835.84 512 682.666667 358.826667 682.666667 238.08 956.586667 512 682.666667 785.493333 682.666667 664.746667 835.84 512M67.413333 512 341.333333 238.08 341.333333 358.826667 188.16 512 341.333333 664.746667 341.333333 785.493333 67.413333 512Z"})],-1),ve=f("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[f("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[f("path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"}),f("path",{d:"M7 11l5 5l5-5"}),f("path",{d:"M12 4v12"})])],-1),ye=f("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[f("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81c1.66 0 3-1.34 3-3s-1.34-3-3-3s-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65c0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z",fill:"currentColor"})],-1),ke=f("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[f("g",{fill:"none"},[f("path",{d:"M12 1.75a3.25 3.25 0 0 1 3.245 3.066L15.25 5h5.25a.75.75 0 0 1 .102 1.493L20.5 6.5h-.796l-1.28 13.02a2.75 2.75 0 0 1-2.561 2.474l-.176.006H8.313a2.75 2.75 0 0 1-2.714-2.307l-.023-.174L4.295 6.5H3.5a.75.75 0 0 1-.743-.648L2.75 5.75a.75.75 0 0 1 .648-.743L3.5 5h5.25A3.25 3.25 0 0 1 12 1.75zm6.197 4.75H5.802l1.267 12.872a1.25 1.25 0 0 0 1.117 1.122l.127.006h7.374c.6 0 1.109-.425 1.225-1.002l.02-.126L18.196 6.5zM13.75 9.25a.75.75 0 0 1 .743.648L14.5 10v7a.75.75 0 0 1-1.493.102L13 17v-7a.75.75 0 0 1 .75-.75zm-3.5 0a.75.75 0 0 1 .743.648L11 10v7a.75.75 0 0 1-1.493.102L9.5 17v-7a.75.75 0 0 1 .75-.75zm1.75-6a1.75 1.75 0 0 0-1.744 1.606L10.25 5h3.5A1.75 1.75 0 0 0 12 3.25z",fill:"currentColor"})])],-1),Be=se({__name:"ActionCard",props:{snapshot:{},onDelete:{type:Function,default:()=>()=>{}},showPreview:{type:Boolean,default:!0},showExport:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},showShare:{type:Boolean,default:!0}},setup(t){const e=t,i=ie(),r=_(async()=>we(await b.getItem(e.snapshot.id))),c=_(async()=>he(await b.getItem(e.snapshot.id))),m=re(()=>i.resolve({name:"snapshot",params:{snapshotId:e.snapshot.id}}).href),p=_(async()=>{const o=await Y(await b.getItem(e.snapshot.id));$({title:"分享链接",content:V(o)})}),w=_(async()=>{const o=await ee(await b.getItem(e.snapshot.id));$({title:"分享链接",content:V(o)})}),v=async()=>{await b.removeItem(e.snapshot.id),await j(500),e.onDelete()};return(o,n)=>(x(),A(s(U),null,{default:l(()=>[o.showPreview?(x(),le("a",{key:0,target:"_blank",href:m.value},[u(s(g),{size:"small"},{icon:l(()=>[u(s(S),null,{default:l(()=>[me]),_:1})]),_:1})],8,ge)):E("",!0),o.showExport?(x(),A(s(J),{key:1},{trigger:l(()=>[u(s(g),{size:"small"},{icon:l(()=>[u(s(S),null,{default:l(()=>[ve]),_:1})]),_:1})]),default:l(()=>[u(s(U),{vertical:""},{default:l(()=>[u(s(g),{onClick:s(r).invoke,loading:s(r).loading},{default:l(()=>[L(" 下载-png ")]),_:1},8,["onClick","loading"]),u(s(g),{onClick:s(c).invoke,loading:s(c).loading},{default:l(()=>[L(" 下载-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):E("",!0),o.showShare?(x(),A(s(J),{key:2},{trigger:l(()=>[u(s(g),{size:"small"},{icon:l(()=>[u(s(S),null,{default:l(()=>[ye]),_:1})]),_:1})]),default:l(()=>[u(s(U),{vertical:""},{default:l(()=>[u(s(g),{onClick:s(p).invoke,loading:s(p).loading},{default:l(()=>[L(" 生成链接-png ")]),_:1},8,["onClick","loading"]),u(s(g),{onClick:s(w).invoke,loading:s(w).loading},{default:l(()=>[L(" 生成链接-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):E("",!0),o.showDelete?(x(),A(s(g),{key:3,size:"small",onClick:v},{icon:l(()=>[u(s(S),null,{default:l(()=>[ke]),_:1})]),_:1})):E("",!0)]),_:1}))}});export{Be as _,Ee as a,Ae as b,Le as c,ze as d,$ as s};
//# sourceMappingURL=ActionCard.vue_vue_type_script_setup_true_lang-7fcd9fc9.js.map
